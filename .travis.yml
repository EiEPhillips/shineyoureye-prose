language: ruby
branches:
  only:
    - gh-pages
notifications:
  email:
    recipients:
      - shineyoureye-deployment@mysociety.org
cache: bundler
script:
  - git clone 'https://github.com/theyworkforyou/shineyoureye-sinatra.git'
  # So that Travis can cache the bundle, copy Gemfile and Gemfile.lock
  # into the top level directory before installing:
  - cp shineyoureye-sinatra/Gemfile{,.lock} .
  - bundle install
  - cd shineyoureye-sinatra
  - git show -s --oneline
  # This is done by bin/deploy anyway, but we need the data for the tests:
  - bin/prepare-data 68b19308fbf4c0c6966ee6fc68d5437a7d29c2b7
  # Check that the tests pass, just in case:
  - bundle exec rake test && travis_wait bin/deploy production
sudo: false
rvm:
  - 2.5.3
